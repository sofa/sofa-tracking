/**
 * sofa-tracking - v0.7.1 - Wed Feb 04 2015 18:17:02 GMT+0100 (CET)
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO)
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(t,a){"use strict";t.define("sofa.tracking.BingTracker",function(t){var a={};return a.setup=function(){},a.trackEvent=function(){},a.trackTransaction=function(a){var e="//flex.msn.com/mstag/tag/"+t.siteId+"/analytics.html?dedup="+(t.dedup||"1")+"&domainId="+t.domainId+"&type="+(t.type||"1")+"&revenue="+a.totals.subtotal+"&actionid="+t.actionId,n=new Image(1,1);n.src=e},a}),t.define("sofa.tracking.GoogleAnalyticsTracker",function(t){var e={};return e.setup=function(){var n=e._gaq=window._gaq=window._gaq||[];n.push(["_setAccount",t.accountNumber]),n.push(["_setDomainName",t.domainName]),n.push(["_setAllowLinker",!0]);var o=a.createElement("script");o.type="text/javascript",o.async=!0,o.src=("https:"===a.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var r=a.getElementsByTagName("script")[0];r.parentNode.insertBefore(o,r)},e.trackEvent=function(t){t.category=t.category||"",t.action=t.action||"",t.label=t.label||"",t.value=t.value||"";var a=[];"pageView"===t.category?(a.push("_trackPageview"),a.push(t.label)):(a.push("_trackEvent"),a.push(t.category),a.push(t.action),a.push(t.label),t.value&&a.push(t.value)),_gaq.push(a)},e.trackTransaction=function(a){if(t.conversionId){var e="http://www.googleadservices.com/pagead/conversion/"+t.conversionId+"/?value="+a.totals.subtotal+"&label="+t.conversionLabel+"&guid=ON&script=0",n=new Image(1,1);n.src=e}_gaq.push(["_gat._anonymizeIp"]),_gaq.push(["_addTrans",a.token,location.host,a.totals.subtotal,a.totals.vat,a.totals.shipping,"","",a.billing.countryname]),a.items.forEach(function(t){_gaq.push(["_addItem",a.token,t.productId,t.name,"",t.price,t.qty])}),_gaq.push(["_trackTrans"])},e}),t.define("sofa.tracking.GoogleAnalyticsUniversalTracker",function(t){var e={};return e.setup=function(){var e="ga-disable-"+t.accountNumber;a.cookie.indexOf(e+"=true")>-1&&(window[e]=!0),function(t,a,e,n,o,r,c){t.GoogleAnalyticsObject=o,t[o]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},t[o].l=1*new Date,r=a.createElement(e),c=a.getElementsByTagName(e)[0],r.async=1,r.src=n,c.parentNode.insertBefore(r,c)}(window,a,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",t.accountNumber,"auto"),ga("require","linkid","linkid.js"),ga("require","displayfeatures"),ga("require","ec")},e.trackEvent=function(t){ga("set","anonymizeIp",!0),t.category=t.category||"",t.action=t.action||"",t.label=t.label||"",t.value=t.value||"","pageView"===t.category?ga("send","pageview",t.label):ga("send",{hitType:"event",eventCategory:t.category,eventAction:t.action,eventLabel:t.label,eventValue:t.value})},e.trackTransaction=function(t){t.items.forEach(function(t){ga("ec:addProduct",{id:t.sku,name:t.name,category:null,brand:null,variant:null,price:t.price,quantity:t.qty})}),ga("ec:setAction","purchase",{id:t.token,affiliation:null,revenue:t.totals.grandtotal,tax:t.totals.vat,shipping:t.totals.shipping,coupon:null}),ga("send","pageview",{anonymizeIp:!0})},e}),t.define("sofa.tracking.TrackingService",function(a,e,n){var o={},r=o.__trackers=[];return t.observable.mixin(o),o.addTracker=function(t){if(!t.setup)throw new Error("tracker must implement a setup method");if(!t.trackEvent)throw new Error("tracker must implement a trackEvent method");if(!t.trackTransaction)throw new Error("tracker must implement a trackTransaction method");t.setup(),r.push(t)},o.trackEvent=function(t){o.emit("trackEvent",o,t),r.forEach(function(a){a.trackEvent(t)})},o.trackTransaction=function(a){var c=n.get("checkoutUrl")+"summaryfin.php";e.get(c+"?token="+a+"&details=get").then(function(e){var n=t.Util.toJson(e.data);n.token=a,o.emit("trackTransaction",o,n),r.forEach(function(t){t.trackTransaction(n)})})},o})}(sofa,document);