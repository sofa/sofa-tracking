/**
 * sofa-tracking - v0.5.0 - 2014-08-05
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a){"use strict";a.define("sofa.tracking.BingTracker",function(a){var b={};return b.setup=function(){},b.trackEvent=function(){},b.trackTransaction=function(b){var c="//flex.msn.com/mstag/tag/"+a.siteId+"/analytics.html?dedup="+(a.dedup||"1")+"&domainId="+a.domainId+"&type="+(a.type||"1")+"&revenue="+b.totals.subtotal+"&actionid="+a.actionId,d=new Image(1,1);d.src=c},b}),a.define("sofa.tracking.GoogleAnalyticsTracker",function(a){var b={};return b.setup=function(){var c=b._gaq=window._gaq=window._gaq||[];c.push(["_setAccount",a.accountNumber]),c.push(["_setDomainName",a.domainName]),c.push(["_setAllowLinker",!0]);var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(d,e)},b.trackEvent=function(a){a.category=a.category||"",a.action=a.action||"",a.label=a.label||"",a.value=a.value||"";var b=[];"pageView"===a.category?(b.push("_trackPageview"),b.push(a.label)):(b.push("_trackEvent"),b.push(a.category),b.push(a.action),b.push(a.label),a.value&&b.push(a.value)),_gaq.push(b)},b.trackTransaction=function(b){if(a.conversionId){var c="http://www.googleadservices.com/pagead/conversion/"+a.conversionId+"/?value="+b.totals.subtotal+"&label="+a.conversionLabel+"&guid=ON&script=0",d=new Image(1,1);d.src=c}_gaq.push(["_gat._anonymizeIp"]),_gaq.push(["_addTrans",b.token,location.host,b.totals.subtotal,b.totals.vat,b.totals.shipping,"","",b.billing.countryname]),b.items.forEach(function(a){_gaq.push(["_addItem",b.token,a.productId,a.name,"",a.price,a.qty])}),_gaq.push(["_trackTrans"])},b}),a.define("sofa.tracking.TrackingService",function(b,c,d){var e={},f=e.__trackers=[];return a.observable.mixin(e),e.addTracker=function(a){if(!a.setup)throw new Error("tracker must implement a setup method");if(!a.trackEvent)throw new Error("tracker must implement a trackEvent method");if(!a.trackTransaction)throw new Error("tracker must implement a trackTransaction method");a.setup(),f.push(a)},e.trackEvent=function(a){e.emit("trackEvent",e,a),f.forEach(function(b){b.trackEvent(a)})},e.trackTransaction=function(b){var g=d.get("checkoutUrl")+"summaryfin.php";c.get(g+"?token="+b+"&details=get").then(function(c){var d=a.Util.toJson(c.data);d.token=b,e.emit("trackTransaction",e,d),f.forEach(function(a){a.trackTransaction(d)})})},e})}(sofa);